{% extends 'base.html' %}
{% block content %}
<h1>My Saved Recipes</h1>
<ul id="savedRecipeList">
{% for recipe in saved_recipes %}
    <li>
        <strong>{{ recipe.title }}</strong> by <em>{{ recipe.author.username }}</em> 
        (Likes: <span id="like-count-{{ recipe.id }}">{{ recipe.likes|length }}</span>)
        
        <button class="view-details-button" data-recipe-id="{{ recipe.id }}">View Details</button>

        {% if current_user.is_authenticated %}
            {% set user_liked = (recipe.likes|selectattr('user_id','equalto',current_user.id)|list) %}
            {% set user_saved = (recipe.saved_by|selectattr('user_id','equalto',current_user.id)|list) %}
            
            <button class="like-button" data-recipe-id="{{ recipe.id }}">
                {% if user_liked %}
                    Unlike
                {% else %}
                    Like
                {% endif %}
            </button>
            <button class="save-button" data-recipe-id="{{ recipe.id }}">
                {% if user_saved %}
                    Unsave
                {% else %}
                    Save
                {% endif %}
            </button>
        {% endif %}
    </li>
{% endfor %}
</ul>
{% endblock %}
